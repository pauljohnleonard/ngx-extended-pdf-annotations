<div
  [ngClass]="{
    'comment-outer-container': true,
    'mat-elevation-z8': true,
    'blue-border': hasFocus
  }"
  (click)="clicked()"
>
  <div class="comment-inner-container">
    <ng-container
      *ngFor="let item of comment.records; first as isFirst; last as isLast"
    >
      <ng-container *ngIf="isFirst || hasFocus">
        <div class="comment-top-meta-info">
          <ng-container *ngIf="item.type === AnnotationItemType.COMMENT">
            <mat-icon
              *ngIf="item.mark.type === AnnotationType.PEN"
              class="myicon"
              >gesture</mat-icon
            >
            <mat-icon
              *ngIf="item.mark.type === AnnotationType.TEXT"
              class="myicon"
              >title</mat-icon
            >
            <mat-icon
              *ngIf="item.mark.type === AnnotationType.NOTE"
              class="myicon"
              >chat_bubble_outline</mat-icon
            >
          </ng-container>
          <div class="comment-name-and-date">
            <div class="name">{{ item.userName }}</div>
            <div class="date">
              {{ date.formatDate(item.createdAt) }}
            </div>
          </div>

          <span class="filler"></span>

          <ng-container *ngIf="item.userId === annotationService._user.userId">
            <mat-icon
              *ngIf="isFirst && item.shared"
              class="myicon"
              matTooltip="Public comment. Click to make private."
              (click)="toogleVisibility(item)"
              >visibility</mat-icon
            >
            <mat-icon
              *ngIf="!item.shared"
              class="myicon"
              matTooltip="Comment is private. Click to share."
              (click)="toogleVisibility(item)"
              >visibility_off</mat-icon
            >

            <div class="chat-message-buttons">
              <button
                mat-icon-button
                [matMenuTriggerFor]="commentMenu"
                class="menu-button"
                aria-label="Menu"
              >
                <mat-icon>more_vert</mat-icon>
              </button>

              <mat-menu #commentMenu="matMenu">
                <button
                  mat-menu-item
                  (click)="editItem(item)"
                  aria-label="Edit Comment"
                >
                  <mat-icon>edit</mat-icon>
                  <span i18n="@@annotation_edit_record">Edit</span>
                </button>

                <button
                  mat-menu-item
                  (click)="deleteItem(item)"
                  aria-label="Delete comment"
                >
                  <mat-icon>delete</mat-icon>
                  <span i18n="@@chat_delete-message">Delete</span>
                </button>
              </mat-menu>
            </div>
          </ng-container>
        </div>

        <div
          *ngIf="(item !== inputRecord || !editing) && !!item.bodyValue"
          class="comment-body-container"
        >
          <div class="comment-body">
            {{ item.bodyValue }}
          </div>
        </div>

        <!-- {{ item.id }} {{ inputRecord.id }} -->

        <ng-container *ngIf="item === inputRecord && editing">
          <mat-form-field class="comment-body-formfield" appearance="outline">
            <textarea
              matInput
              class="comment-window-textarea-message-input"
              i18n-placeholder="@@YourCommentPlaceHolder"
              [placeholder]="
                item.type === AnnotationItemType.COMMENT ? 'Comment' : 'Reply'
              "
              [formControl]="inputFormControl"
              autocomplete="off"
              cdkTextareaAutosize
              cdkAutosizeMinRows="1"
              cdkAutosizeMaxRows="5"
              #messageinput
            >
            </textarea>
          </mat-form-field>

          <button
            style="margin-top: 10px"
            mat-raised-button
            (click)="saveItem(item)"
            [disabled]="!inputFormControl.dirty"
            [matTooltip]="getSaveToolTip(item)"
            color="primary"
          >
            Save
          </button>
        </ng-container>

        <!-- dirty: {{ item.dirty }} published:{{ item.shared }} virgin:{{
          item.virgin
        }} -->

        <div
          *ngIf="!isLast && hasFocus"
          style="
            width: 100%;
            background-color: grey;
            height: 1px;
            margin-bottom: 10px;
          "
        ></div>
      </ng-container>
    </ng-container>

    <ng-container *ngIf="1 || (hasFocus && editing && !inputRecord)">
      <!-- <mat-form-field class="comment-body-formfield" appearance="outline">
        <textarea
          matInput
          class="comment-window-textarea-message-input"
          i18n-placeholder="@@YourCommentPlaceHolder"
          [placeholder]="comment.records.length === 0 ? 'Comment' : 'Reply'"
          [formControl]="inputFormControl"
          autocomplete="off"
          cdkTextareaAutosize
          cdkAutosizeMinRows="1"
          cdkAutosizeMaxRows="5"
          #messageinput
        >
        </textarea>
      </mat-form-field>

      <button
        style="margin-top: 10px"
        mat-raised-button
        (click)="saveNewItem()"
        [disabled]="!inputFormControl.dirty"
        matTooltip="Save comment"
        color="primary"
      >
        Save
      </button> -->
    </ng-container>

    <div
      *ngIf="!hasFocus && comment.records.length > 1"
      style="display: flex; width: 100%; justify-content: flex-end"
    >
      <mat-icon
        [matBadge]="comment.records.length - 1"
        matBadgeOverlap="false"
        matBadgeSize="medium"
        matBadgePosition="before"
      >
        expand_more</mat-icon
      >
    </div>
  </div>
</div>
