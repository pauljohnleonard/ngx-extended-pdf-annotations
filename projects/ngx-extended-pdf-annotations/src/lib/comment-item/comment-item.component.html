<div
  [ngClass]="{
    'comment-outer-container': true,
    'mat-elevation-z8': true,
    'blue-border': hasFocus
  }"
  (click)="clicked()"
>
  <div class="comment-inner-container">
    <ng-container
      *ngFor="let item of comment.records; first as isFirst; last as isLast"
    >
      <ng-container *ngIf="isFirst || hasFocus">
        <div class="comment-top-meta-info">
          <mat-icon
            *ngIf="item.type === AnnotationItemType.COMMENT"
            class="myicon"
            >gesture</mat-icon
          >
          <div class="comment-name-and-date">
            <div class="name">{{ item.userName }}</div>
            <div class="date">
              {{ date.formatDate(item.createdAt) }}
            </div>
          </div>

          <span class="filler"></span>

          <ng-container *ngIf="item.type === AnnotationItemType.COMMENT">
            <mat-icon
              *ngIf="item.published"
              class="myicon"
              matTooltip="Public comment. Click to make private."
              (click)="toogleVisibility()"
              >visibility</mat-icon
            >
            <mat-icon
              *ngIf="!item.published"
              class="myicon"
              matTooltip="Comment is private. Publish to share."
              >visibility_off</mat-icon
            >
          </ng-container>

          <div class="chat-message-buttons" *ngIf="hasFocus && isFirst">
            <button
              mat-icon-button
              [matMenuTriggerFor]="commentMenu"
              class="menu-button"
              aria-label="Menu"
            >
              <mat-icon>more_vert</mat-icon>
            </button>

            <mat-menu #commentMenu="matMenu">
              <button
                mat-menu-item
                (click)="annotationService._deleteComment(comment)"
                aria-label="Delete comment"
              >
                <mat-icon>delete</mat-icon>
                <span i18n="@@chat_delete-message">Delete message</span>
              </button>
            </mat-menu>
          </div>
        </div>

        <div *ngIf="item !== inputRecord" class="comment-body-container">
          <div class="comment-body">
            {{ item.bodyValue }}
          </div>
        </div>

        <!-- {{ item.id }} {{ inputRecord.id }} -->

        <ng-container *ngIf="item === inputRecord">
          <mat-form-field class="comment-body-formfield" appearance="outline">
            <textarea
              matInput
              class="comment-window-textarea-message-input"
              i18n-placeholder="@@YourCommentPlaceHolder"
              [placeholder]="
                item.type === AnnotationItemType.COMMENT ? 'Comment' : 'Reply'
              "
              [formControl]="inputFormControl"
              autocomplete="off"
              cdkTextareaAutosize
              cdkAutosizeMinRows="1"
              cdkAutosizeMaxRows="5"
              #messageinput
            >
            </textarea>
          </mat-form-field>

          <button
            style="margin-top: 10px"
            mat-raised-button
            (click)="publishItem(item)"
            [disabled]="
              (item.published && !item.dirty) ||
              (!item.published && !item.bodyValue)
            "
            [matTooltip]="getPublishToolTip(item)"
            color="primary"
          >
            Publish
          </button>
        </ng-container>

        <!-- dirty: {{ item.dirty }} published:{{ item.published }} virgin:{{
          item.virgin
        }} -->

        <!-- <div
          *ngIf="0 && !isLast"
          style="
            width: 100%;
            background-color: grey;
            height: 1px;
            margin-bottom: 10px;
          "
        ></div> -->
      </ng-container>
    </ng-container>
  </div>
</div>
